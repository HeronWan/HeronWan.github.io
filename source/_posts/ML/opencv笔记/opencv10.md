
## 10，**图像轮廓**

边缘检测虽然能够检测出边缘，但是边缘是不连续的，检测到的边缘并不是一个整体，图像轮廓是指将边缘连接起来形成一个整体，用于后续的计算。

通过对图像轮廓的操作，我们能够获得目标图像的大小，位置，方向等信息
### **查找并绘制轮廓**

一个轮廓对应着一系列的点，这些点以某种方式表示图像中的一条曲线

`cv.findContours()`用于查找图像的轮廓，并能够根据参数返回特定方式的轮廓曲线，函数`cv2.drowContours()`能将查找到的轮廓绘制到图像上

### **矩特征**

比较两个轮廓最简单的方法就是比较两者的轮廓矩。轮廓矩代表着一个轮廓、一幅图像，一组点集的全局特征。矩信息包含了对应对象不同类型的几何特征，例如大小、位置、角度、形状等。矩特征被广泛用于模式识别和图像识别等方便

1. 矩的计算：moments函数
   
`retval = cv2.moments(array, binaryImage)`
  - array 可以是点集，也可以是灰度图像或二值图像，整个点击作为一条轮廓
  - binaryImage：若为true，array中所有非0值都被处理成1
  - retval 返回值是一个特征矩，主要包括：
    - 空间矩,计算面积、周长
      - 零阶矩:m00
      - 一阶矩:m10,m01
      - 二阶矩:m20,m11
      - 三阶矩:m30
    - 中心距：计算平移不变性，比较不同位置对象是否一致
      - 二阶中心距:mu20,mu11
      - 三阶中心距:mu30
    - 归一化中心矩：通过除以物体的总尺寸而获得的缩放不变性，具有平移不变性，还具有缩放不变性
      - 二阶hu矩:nu20,nu11,nu02
      - 三阶hu矩:nu30,nu21,nu12,nu03

2.计算轮廓的长度：arcLength函数
  `retval = cv2.arcLength(curve, closed)`
  - retval返回值是轮廓的周长
  - curve 是轮廓
  - closed是布尔值，用来表示轮廓是否封闭

### **hu钜**

hu矩是归一化中心矩的线型组合。hu矩在图像旋转，缩放，平移等操作后，仍能保持矩的不变性，所以经常会使用hu矩来识别图像额特征

`hu = cv2.HuMoments(m)`

### **轮廓拟合**


在计算轮廓时，可能并不需要实际的轮廓，而仅需要一个接近于轮廓的近似多边形的方法。

1. 轮廓拟合

`x, y, w, h = cv2.boundingRect( array)`

  - array 是灰度图像或轮廓
  - 该函数具有四个返回值,分别表示：
  - 矩阵边界左上角顶点的x坐标
  - 矩阵边界左上角顶点的y坐标
  - 矩阵边界x方向的长度
  - 矩阵边界y方向的长度

2. 最小包围矩阵框
`retval = cv2.minAreaRect(array)`
 - 返回值retval表示返回的矩阵特征信息， 该值结构是：
   - 最小外接矩形的中心，
   - （宽度，高度），
   - 旋转角


3. 最小包围圆形
`center,radius = cv2.minEnclosingCircle(array)`

4. 最优拟合直线

5. 最小包围三角形

6. 逼近多边形

### **凸包**

逼近多边形是轮廓的高度近似，但是有时候，我们希望使用一个多边形的凸包，来简化它。凸包跟逼近多边形很像，只不过他是物体最外层的凸多边形。凸包指的是完全包括原有轮廓，并且仅由轮廓上的点所构成的多边形

在凸包中，任意连续三个点的内角小于180度

1. 获取凸包
2. 凸缺陷
   1. 凸包和轮廓之间的部分，称为凸缺陷，
3. 几何学测试
   1. 测试轮廓是否是凸型的
   2. 点到轮廓的距离：
    `retval = cv2.pointPolygonTest( contour, pt, measureDist)`

### **利用形状场景算法比较轮廓**

用矩比较形状是一种非常有效的方法，不过现在有更高效的方法。

从opencv3开始，就开始有了专有模块shape，该模块中的形状场景算法能够更高效的比较形状

1. 计算形状场景距离
   1. 

### **轮廓的特征值**

1. 宽高比
  
2. extent 
$$
extent = \frac{轮廓面积(对象面积)}{矩形边界面积}
$$

3. Soliity
   
$$
solidity = \frac{轮廓面积（对象面积）}{凸包面积}
$$

4. 等效直径
   可以用等效直径来衡量轮廓的特征值，该值是与轮廓面积相等的圆形的直径
  $$
等效直径 = \sqrt{\frac{4\times轮廓面积}{\pi}}
$$

5. 方向
   函数cv2.fitEllipse()可以用来构造最优拟合椭圆，还可以在返回椭圆的中心点、轴长、旋转角度等信息。使用这种形式能够更直观地获取椭圆的方向等信息

6. 掩膜和像素点
   有时我们希望获取对象的掩膜图像以及对应的点

7. 平均颜色与平均灰度
8. 极点
   1. 有时候我们希望获取某个对象的极值点，例如最左端、最右端、最上端、最下端的四个点。
   2. opencv提供了相应的函数找出这些点